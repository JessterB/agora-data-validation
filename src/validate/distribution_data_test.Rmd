---
title: "distribution_data.json"
output: html_notebook
---

```{r eval=FALSE, echo=FALSE}
source("~/repos/rstudio/agora-data-validation/src/utils.R")
prepare()
```

# Validation run metadata
```{r echo=FALSE}
# add file-specific values here
name <- "distribution_data"
old_synId <-  "syn26274945" 
new_synId <- "syn27572407"

# not file-specific
old_name <- paste(name, "old", sep="_")
new_name <- paste(name, "new", sep="_")
rules <- paste0("rules_", name)

# print validation summary
cat( name, ".json", "\n", date(),
    "\nold: ", old_synId, " \nnew: ", new_synId,
    sep="")
```

# Downloaded files
```{r echo=FALSE}
source("~/repos/rstudio/agora-data-validation/src/utils.R")
download_files(old_synId, new_synId, name)
```

# Compared old & new files
```{r echo=FALSE}
source("~/repos/rstudio/agora-data-validation/src/utils.R")
compare(get(old_name), get(new_name), name, summarize=FALSE)
```


# Validated new file against rules
```{r echo=FALSE}
source("~/repos/rstudio/agora-data-validation/src/utils.R")
source("~/repos/rstudio/agora-data-validation/src/rules/rules_distribution_data.R")
test(get(new_name), get(rules))
```


***
# Outstanding validation failures
***
N/A

***
# Validation failure investigations
***

```{r echo=FALSE}
# yields a dataframe containing the failure cases for a specific rule
v <- validator(VALIDATION_RULE)
cf <- confront(DATAFRAME, v)
out <- values(cf)
is_unique_fails <- DATAFRAME[!out,]
is_unique_fails
```

***
# Other validation
***

## Distribution validation

Ensure that no scores were dropped by validating that the distributions contain the expected total number of genes



```{r echo=FALSE}
cat("\nOverall distribution total genes: ", sum(distribution_data_new$Logsdon.distribution))
cat("\nOverall total genes expected: ", "24659") # from overall_scores_test.json (AG-407)

cat("\n\nGenomics distribution total genes: ", sum(distribution_data_new$OmicsScore.distribution))
cat("\nGenomics total genes expected: ", "23876") # from overall_scores_test.json (AG-407)

cat("\n\nLiterature distribution total genes: ", sum(distribution_data_new$LiteratureScore.distribution))
cat("\nLiterature total genes expected: ", "15656") # from overall_scores_test.json (AG-407)

cat("\n\nGenetics distribution total genes: ", sum(distribution_data_new$GeneticsScore.distribution))
cat("\nGenetics total genes expected: ", "23319") # from overall_scores_test.json (AG-407)
```

Testing data v4 results:

Overall distribution total genes:  24659
Overall total genes expected:  24659

Genomics distribution total genes:  23876
Genomics total genes expected:  23876

Literature distribution total genes:  15656
Literature total genes expected:  15656

Genetics distribution total genes:  23319
Genetics total genes expected:  23319

